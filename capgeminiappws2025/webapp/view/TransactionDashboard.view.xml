<mvc:View
  controllerName="capgeminiappws2025.controller.TransactionDashboard"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core"
  displayBlock="true">

  <Page title="Compliance - Exception Dashboard">
    <content>
      <VBox class="sapUiSmallMargin sapUiContentPadding">

        <!-- Filter Bar -->
        <Toolbar>
          <Title text="Filters" level="H3"/>
          <ToolbarSpacer/>

          <Label text="From" class="sapUiTinyMarginEnd"/>
          <DatePicker id="dpFrom" width="10rem"/>

          <Label text="To" class="sapUiTinyMarginBegin sapUiTinyMarginEnd"/>
          <DatePicker id="dpTo" width="10rem"/>

          <Label text="Plant" class="sapUiTinyMarginBegin sapUiTinyMarginEnd"/>
          <Input id="inPlant" width="7rem" placeholder="e.g. 1000"/>

          <Button text="Apply" type="Emphasized" press=".onApply" class="sapUiTinyMarginBegin"/>
          <Button text="Reset" press=".onReset" class="sapUiTinyMarginBegin"/>
        </Toolbar>

        <!-- KPI Row -->
        <HBox class="sapUiSmallMarginTop" justifyContent="SpaceBetween" wrap="Wrap">
          <VBox width="32%">
            <ObjectStatus title="Total Exceptions"
              text="{vm>/kpi/total}"
              state="Information"/>
          </VBox>

          <VBox width="32%">
            <ObjectStatus title="Adjustments (701/702)"
              text="{vm>/kpi/adjustment}"
              state="Warning"/>
          </VBox>

          <VBox width="32%">
            <ObjectStatus title="Reversals (102/122/262/602)"
              text="{vm>/kpi/reversal}"
              state="Error"/>
          </VBox>
        </HBox>

        <!-- Top Materials Table -->
        <Table
          id="tblTopMaterials"
          class="sapUiSmallMarginTop"
          headerText="Top Materials (by exception count)"
          growing="true"
          growingScrollToLoad="true"
          mode="None"
          items="{vm>/topMaterials}">

          <columns>
            <Column width="16rem">
              <Text text="Material"/>
            </Column>
            <Column hAlign="End" width="10rem">
              <Text text="Exception Count"/>
            </Column>
          </columns>

          <items>
            <ColumnListItem>
              <cells>
                <Text text="{vm>Material}"/>
                <ObjectNumber number="{vm>ExceptionCount}"/>
              </cells>
            </ColumnListItem>
          </items>
        </Table>

        <!-- Optional: Raw Exceptions count info -->
        <Text class="sapUiTinyMarginTop"
          text="Tip: If KPIs are 0, check browser Network tab for the /Exceptions call and verify EntitySet name."/>
      </VBox>
    </content>
  </Page>
</mvc:View>
