<mvc:View
    controllerName="capgeminiappws2025.controller.Configurator"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.ui.layout.form"
>
    <Page
        id="configurator"
        title="Regulatory Framework Configuration"
    >
        <content>
            <HBox
                width="100%"
                renderType="Bare"
                class="sapUiContentPadding"
            >
                <!-- ================= LEFT CARD: Active Regulations ================= -->
                <VBox class="sapUiSmallMarginEnd">
                    <Panel
                        class="sapUiResponsiveMargin"
                        backgroundDesign="Solid"
                    >
                        <headerToolbar>
                            <Toolbar>
                                <Title
                                    text="Active Regulations"
                                    level="H5"
                                />
                                <ToolbarSpacer /> 
                                <Button
                                    id="btnSelectMarket"
                                    text="{= ${ui>/selectedMarket} ? 'Market: ' + ${ui>/selectedMarket} : 'Select Market' }"
                                    icon="sap-icon://world"
                                    type="Transparent"
                                    press=".onPressSelectMarket"
                                />

                                <Button
                                    icon="sap-icon://sys-cancel"
                                    tooltip="Clear market filter"
                                    visible="{= !!${ui>/selectedMarket} }"
                                    press=".onClearMarketFilter"
                                />

                                <Button
                                    text="Add Regulation"
                                    icon="sap-icon://add"
                                    type="Transparent"
                                    press="onPressAddRegulation"
                                />
                            </Toolbar>
                        </headerToolbar>

                        <List
                            id="regulationList"
                            mode="SingleSelectMaster"
                            items="{ path: '/Z_I_ZREGULATION', templateShareable: false }"
                            selectionChange=".onSelectRegulation"
                        >
                            <CustomListItem
                                type="Active"
                            >
                                <VBox class="sapUiSmallMargin">
                                    <HBox
                                        alignItems="Center"
                                        fitContainer="false"
                                    >
                                        <!-- left column: text OR input; grows to fill available space -->
                                        <VBox width="100%">
                                            <layoutData>
                                                <FlexItemData growFactor="1" />
                                            </layoutData>
                                            <!-- Display -->
                                            <Text
                                                text="{= ${Title} ? ${Title} : '(Untitled regulation)' }"
                                                visible="{= ${ui>/editRegulationId} !== ${Id} }"
                                            />

                                            <!-- Edit -->
                                            <Input
                                                id="regulationTitleInput"
                                                value="{path: 'Title', mode: 'sap.ui.model.BindingMode.TwoWay'}"
                                                visible="{= ${ui>/editRegulationId} === ${Id} }"
                                                submit=".onSubmitRegulationTitle"
                                                change=".onSubmitRegulationTitle"
                                            />
                                        </VBox>

                                        <!-- right column: action buttons -->
                                        <HBox
                                            alignItems="Center"
                                            justifyContent="End"
                                            renderType="Bare"
                                        >
                                            <Button
                                                icon="sap-icon://edit"
                                                type="Transparent"
                                                press=".onEditRegulation"
                                                tooltip="Edit regulation"
                                            />
                                            <Button
                                                icon="sap-icon://delete"
                                                type="Reject"
                                                press=".onDeleteRegulation"
                                                tooltip="Delete regulation"
                                            />
                                        </HBox>
                                    </HBox>
                                </VBox>
                            </CustomListItem>
                        </List>
                    </Panel>
                </VBox>

                <!-- ================= RIGHT CARD: Regulation Details ================= -->
                <VBox
                    width="100%"
                    id="detailPanel"
                    visible="false"
                >
                    <Panel
                        class="sapUiResponsiveMargin"
                        backgroundDesign="Solid"
                    >
                        <!-- Header -->
                        <VBox class="sapUiSmallMargin">
                            <Title
                                text="{Title}"
                                level="H4"
                            />
                            <Text
                                text="{Description}"
                                class="sapUiTinyMarginBottom"
                            />
                        </VBox>

                        <!-- ===== Compliance Rules ===== -->
                        <HBox
                            justifyContent="SpaceBetween"
                            class="sapUiMediumMarginTop sapUiSmallMarginBegin sapUiSmallMarginEnd"
                        >
                            <Title
                                text="Compliance Rules"
                                level="H6"
                            />
                            <Button
                                text="Add Rule"
                                icon="sap-icon://add"
                                type="Transparent"
                                press=".onPressAddRule"
                            />
                        </HBox>

                        <Table
                            id="rulesTable"
                            class="sapUiMediumMargin"
                            width="90%"
                        >
                            <columns>
                                <Column>
                                    <Text text="View" />
                                </Column>
                                <Column>
                                    <Text text="Field" />
                                </Column>
                                <Column hAlign="Center">
                                    <Text text="Active" />
                                </Column>
                                <Column
                                    styleClass="sapUiSmallMarginBegin"
                                    hAlign="End"
                                >
                                    <Text text="Actions" />
                                </Column>
                            </columns>

                            <items>
                                <ColumnListItem>
                                    <cells>
                                        <!-- Viewname: display only -->
                                        <Text text="{Viewname}" />

                                        <!-- Elementname: display only -->
                                        <Text text="{Elementname}" />

                                        <!-- Active: editable via Switch only -->
                                        <VBox>
                                            <Text
                                                text="{= ${Active} ? 'Active' : 'Inactive'}"
                                                visible="{= !${ui>/editRuleId} }"
                                            />
                                            <!-- keep binding two-way so change handler can update model -->
                                            <Switch
                                                state="{path: 'Active', mode: 'sap.ui.model.BindingMode.TwoWay'}"
                                                change=".onSubmitRuleField"
                                            />
                                        </VBox>

                                        <!-- Actions: delete only (no edit) -->
                                        <HBox
                                            justifyContent="End"
                                            renderType="Bare"
                                        >
                                            <Button
                                                icon="sap-icon://delete"
                                                type="Reject"
                                                press=".onDeleteRule"
                                                tooltip="Delete rule"
                                            />
                                        </HBox>
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>

                        <!-- ===== Footer Actions ===== -->
                        <HBox
                            class="sapUiMediumMargin"
                            justifyContent="Start"
                        >
                            <Button
                                text="Save Configuration"
                                type="Emphasized"
                                icon="sap-icon://save"
                                press=".onPressSaveConfiguration"
                                enabled="false"
                            />
                            <Button
                                text="Start Readiness Check"
                                class="sapUiTinyMarginBegin"
                                press=".onPressStartReadinessCheck"
                            />
                        </HBox>
                    </Panel>
                </VBox>
            </HBox>
        </content>
    </Page>
</mvc:View>
