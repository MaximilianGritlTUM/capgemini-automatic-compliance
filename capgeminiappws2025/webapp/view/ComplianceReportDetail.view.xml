<mvc:View
    controllerName="capgeminiappws2025.controller.ComplianceReportDetail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:table="sap.ui.table">

    <Page id="reportDetailPage" title="Regulatory Readiness Report" enableScrolling="true">
        <headerContent>
            <!-- Export Button -->
            <Button
                text="Export"
                icon="sap-icon://download"
                type="Transparent"
                press=".onExportReport" />
        </headerContent>

        <content>
            <VBox width="100%" renderType="Div" class="sapUiSmallMargin">
                <!-- Header: Regulation, Fulfillment, Timestamp, Audit Trail etc -->
                <ObjectHeader
                    title="{regulation}"
                    intro="Regulation"
                    number="{degree_fulfill}"
                    numberUnit="% Fulfillment"
                    responsive="true">
                    <attributes>
                        <ObjectAttribute
                            title="Report ID"
                            text="{report_id}" />
                        <ObjectAttribute
                            title="Run Timestamp"
                            text="{run_timestamp}" />
                        <ObjectAttribute
                            title="Compliance Relevance"
                            text="{ComplianceRelevance}" />
                        <ObjectAttribute
                            title="Audit Trail ID"
                            text="{AuditTrailId}" />
                    </attributes>
                </ObjectHeader>

                <!--  Data availability / quality / gap / recommendations -->
                <HBox class="sapUiSmallMarginTop sapUiSmallMarginBottom" justifyContent="SpaceBetween">
                    <VBox class="sapUiTinyMarginEnd" width="25%">
                        <Title text="Data Availability" level="H5" />
                        <Text text="Available, partially available, missing data overview" />
                    </VBox>
                    <VBox class="sapUiTinyMarginEnd" width="25%">
                        <Title text="Data Quality" level="H5" />
                        <Text text="{DataQualitySummary}" />
                    </VBox>
                    <VBox class="sapUiTinyMarginEnd" width="25%">
                        <Title text="Data Gaps" level="H5" />
                        <Text text="{DataGapsSummary}" />
                    </VBox>
                    <VBox width="25%">
                        <Title text="Actionable Recommendations" level="H5" />
                        <Text text="{RecommendationsSummary}" />
                    </VBox>
                </HBox>

                <!-- Filter Bar -->
                <HBox class="sapUiSmallMarginTop sapUiSmallMarginBottom" alignItems="Center">
                    <Label text="Filter by Activity:" class="sapUiTinyMarginEnd" />
                    <Select
                        id="activityFilter"
                        change=".onActivityFilterChange"
                        width="200px">
                        <core:Item key="ALL" text="All" />
                        <core:Item key="ACTIVE" text="Active" />
                        <core:Item key="INACTIVE" text="Inactive" />
                        <core:Item key="DORMANT" text="Dormant" />
                        <core:Item key="N/A" text="No Activity Info" />
                    </Select>
                </HBox>

                <!-- Material / Supplier Result -->
                <IconTabBar expandable="false" class="sapUiSmallMarginTop">
                    <!-- Materials Tab -->
                    <items>
                        <IconTabFilter
                            text="Fields"
                            icon="sap-icon://product">
                            <Table
                                id="materialsTable"
                                inset="false"
                                width="100%"
                                items="{to_Results}">

                                <columns>
                                    <Column>
                                        <Text text="Data Source" />
                                    </Column>
                                    <Column>
                                        <Text text="Field" />
                                    </Column>
                                    <Column>
                                        <Text text="Data Availability" />
                                    </Column>
                                    <Column>
                                        <Text text="Data Quality" />
                                    </Column>
                                    <Column>
                                        <Text text="Data Gaps / Activity" />
                                    </Column>
                                    <Column>
                                        <Text text="Recommendations" />
                                    </Column>
                                </columns>

                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{object_id}" />
                                            <Text text="{object_name}" />
                                            <!-- Data availability: available / partial / missing -->
                                            <ObjectStatus
                                                text="{avail_cat}"
                                                icon="{= ${avail_cat} === 'AVAILABLE' ? 'sap-icon://accept' : ${avail_cat} === 'PARTIAL' ? 'sap-icon://alert' : 'sap-icon://error'}"
                                                state="{= ${avail_cat} === 'AVAILABLE' ? 'Success' : ${avail_cat} === 'PARTIAL' ? 'Warning' : 'Error'}" />
                                            <ObjectStatus
                                                text="{data_quality}"
                                                state="{= ${data_quality} === 'HIGH' ? 'Success' : ${data_quality} === 'MEDIUM' ? 'Warning' : 'Error'}" />
                                            <!-- Data Gaps includes activity status info -->
                                            <Text text="{gap_desc}" />
                                            <Text text="{recommendation}" />
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </IconTabFilter>

                        <!-- BOM Tab -->
                        <IconTabFilter
                            text="BOM"
                            icon="sap-icon://product">
                            <table:TreeTable
                                id="bomTable"
                                rows="{
                                    path: 'bom>/',
                                    parameters: {
                                        arrayNames: ['to_Children']
                                    }
                                }"
                                width="100%"
                                visibleRowCountMode="Fixed"
                                visibleRowCount="10"
                                selectionMode="None">

                                <table:columns>
                                    <table:Column
                                        width="150px">
                                        <Label text="BOM Number" />
                                        <table:template>
                                            <Text text="{= ${bom>bom_number} === '00000000' ? '' : ${bom>bom_number}}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="150px">
                                        <Label text="Material" />
                                        <table:template>
                                            <Text text="{bom>parent_matnr}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="100px">
                                        <Label text="Material Desc" />
                                        <table:template>
                                            <Text text="{bom>material_description}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="80px">
                                        <Label text="Plant" />
                                        <table:template>
                                            <Text text="{bom>Plant}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="100px">
                                        <Label text="Plant Desc" />
                                        <table:template>
                                            <Text text="{bom>plant_description}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="120px">
                                        <Label text="Activity Status" />
                                        <table:template>
                                            <ObjectStatus
                                                text="{bom>activity_status}"
                                                state="{= ${bom>activity_status} === 'ACTIVE' ? 'Success' : ${bom>activity_status} === 'INACTIVE' ? 'Warning' : ${bom>activity_status} === 'DORMANT' ? 'Error' : 'None'}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="120px">
                                        <Label text="Data Availability" />
                                        <table:template>
                                            <ObjectStatus
                                                text="{bom>avail_cat}"
                                                icon="{= ${bom>avail_cat} === 'AVAILABLE' ? 'sap-icon://accept' : ${bom>avail_cat} === 'PARTIAL' ? 'sap-icon://alert' : 'sap-icon://error'}"
                                                state="{= ${bom>avail_cat} === 'AVAILABLE' ? 'Success' : ${bom>avail_cat} === 'PARTIAL' ? 'Warning' : 'Error'}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="100px">
                                        <Label text="Data Quality" />
                                        <table:template>
                                            <ObjectStatus
                                                text="{bom>data_quality}"
                                                state="{= ${bom>data_quality} === 'GOOD' ? 'Success' : ${bom>data_quality} === 'MEDIUM' ? 'Warning' : 'Error'}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="150px">
                                        <Label text="Data Gaps" />
                                        <table:template>
                                            <Text text="{bom>gap_desc}" />
                                        </table:template>
                                    </table:Column>
                                    <table:Column
                                        width="200px">
                                        <Label text="Recommendations" />
                                        <table:template>
                                            <Text text="{bom>recommendation}" />
                                        </table:template>
                                    </table:Column>
                                </table:columns>
                            </table:TreeTable>
                        </IconTabFilter>

                        <!-- Suppliers Tab -->
                        <IconTabFilter
                            text="Suppliers"
                            icon="sap-icon://supplier"
                            visible="false">
                            <Table
                                id="suppliersTable"
                                inset="false"
                                width="100%"
                                items="{to_Results}">

                                <columns>
                                    <Column>
                                        <Text text="Supplier ID" />
                                    </Column>
                                    <Column>
                                        <Text text="Name" />
                                    </Column>
                                    <Column>
                                        <Text text="Data Availability" />
                                    </Column>
                                    <Column>
                                        <Text text="Data Quality" />
                                    </Column>
                                    <Column>
                                        <Text text="Data Gaps" />
                                    </Column>
                                    <Column>
                                        <Text text="Recommendations" />
                                    </Column>
                                    <Column>
                                        <Text text="Data Source" />
                                    </Column>
                                </columns>

                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{ObjectId}" />
                                            <Text text="{ObjectName}" />
                                            <ObjectStatus
                                                text="{avail_cat}"
                                                icon="{= ${avail_cat} === 'AVAILABLE' ? 'sap-icon://accept' : ${avail_cat} === 'PARTIAL' ? 'sap-icon://alert' : 'sap-icon://error'}"
                                                state="{= ${avail_cat} === 'AVAILABLE' ? 'Success' : ${avail_cat} === 'PARTIAL' ? 'Warning' : 'Error'}" />
                                            <ObjectStatus
                                                text="{data_quality}"
                                                state="{= ${data_quality} === 'GOOD' ? 'Success' : ${data_quality} === 'MEDIUM' ? 'Warning' : 'Error'}" />
                                            <Text text="{gap_desc}" />
                                            <Text text="{recommendation}" />
                                            <Text text="{data_source}" />
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </IconTabFilter>
                    </items>
                </IconTabBar>
            </VBox>
        </content>
    </Page>
</mvc:View>
